package scrapper

import (
	"github.com/gocolly/colly"
	_ "github.com/lib/pq"
	"github.com/umarrohman03/scrapping/internal/env"
	"time"
)

func NewScrapperClient(env *env.ENV) *colly.Collector {
	c := colly.NewCollector(
		//colly.Debugger(&debug.LogDebugger{}),
		colly.UserAgent(env.ScrapperUserAgent),
	)

	//todo move to env for header and timeout
	c.SetRequestTimeout(120 * time.Second)
	c.OnRequest(func(r *colly.Request) {
		r.Headers.Set("User-Agent", "PostmanRuntime/7.33.0")
		r.Headers.Set("cache-control", "no-cache")
		r.Headers.Set("Accept", "*/*")
		r.Headers.Set("Host", "www.tokopedia.com")
		r.Headers.Set("Accept-Encoding", "gzip, deflate, br")
		r.Headers.Set("Connection", "keep-alive")
		r.Headers.Set("Cookie", "dt_intl=DVLT_6542b775e3263c27e321b929-f52fc6e0_dFlt; dt_intl=JT_zu-Ugg8-k7er-RLE3uxF_pA8VtgWhutCG1KDuVruitn; DID=568204658ebef3fd0fc56dac9ae4cdb2d08eb65ff025c76f21d642e9d2caed5d94b7c43a4e9d3dbae2607040d20aa142; DID_JS=NTY4MjA0NjU4ZWJlZjNmZDBmYzU2ZGFjOWFlNGNkYjJkMDhlYjY1ZmYwMjVjNzZmMjFkNjQyZTlkMmNhZWQ1ZDk0YjdjNDNhNGU5ZDNkYmFlMjYwNzA0MGQyMGFhMTQy47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=; _UUID_NONLOGIN_=72680970d1b443a02f02f2e321813d98; hfv_banner=true; _gcl_au=1.1.2116770561.1700371178; _gid=GA1.2.2052660909.1700371178; _UUID_CAS_=67dc2b53-4f16-4722-bb41-5eb27a0c3b9d; _fbp=fb.1.1700371182892.1521242328; g_yolo_production=1; _hjSessionUser_714968=eyJpZCI6ImJkNjRiZjQ1LTc0M2YtNTgxMC05YzEyLWFiOGJhMzI3ZWZlMyIsImNyZWF0ZWQiOjE3MDAzNzExODQyMjUsImV4aXN0aW5nIjp0cnVlfQ==; serverECT=4g; shipping_notif=0; _SID_Tokopedia_=BLn7NaTMFp5gWTtrH_VYqJdNgIwHSTqmxsZEvVp7XMR_fgdd3p-jKKCoCdXLoG9byuTfaa2dFAFpvT3NhOUzbNh3Sr_-FvxQ1EIJVc6g4VvL6i9S4ghli9LRvuIMVecb; G_ENABLED_IDPS=google; g_state={\"i_l\":0}; l=1; tuid=20215146; uide=sNu6Ib5pm8V5HCnZMtlF5ba8vKK8IV2d/UGcrnWUzz1xFqc4; uidh=+LPW/Ir262y7mPann+HRtHVKo1sswXfH6nxWQbLcH/4=; aus=1; _CASE_=71286e436e28303f3c3e3326286b436e28303d3d3b3c333c333c2628666866283028587f676b622a5f676b782a586562676b6428262869436e28303b3d3b26286665646d2830283b3a3c24323b3332333d3d3a3932383c3e39282628666b7e283028273c243e383f3e3d3e3a3c3b3f323e3a3b2826287a49652830283b3c3e3b392826287d436e28303b39383a33393d3d262879436e28303b3b3f393a3f3d392628795e737a6f28302838622826287d6279283028517156287d6b786f62657f796f55636e5628303b39383a33393d3d265628796f787c63696f557e737a6f56283056283862562826562855557e737a6f646b676f56283056285d6b786f62657f796f79562877267156287d6b786f62657f796f55636e5628303a265628796f787c63696f557e737a6f56283056283b3f67562826562855557e737a6f646b676f56283056285d6b786f62657f796f7956287757282628665f7a6e283028383a3839273b3b27383b5e3a3f303933303f3d213a3d303a3a2877; webauthn-session=53c67664-0e61-4454-a126-47d4ce919543; _ga=GA1.2.299990084.1700371178; _gat_UA-9801603-1=1; _ga_70947XW48P=GS1.1.1700535324.9.0.1700535324.60.0.0; ISID=%7B%22www.tokopedia.com%22%3A%22d3d3LnRva29wZWRpYS5jb20%3D.8aa70125fd6d14cbaae6b2ed20ddfc0e.1700535324745.1700535324745.1700535324745.1%22%2C%22accounts.tokopedia.com%22%3A%22YWNjb3VudHMudG9rb3BlZGlhLmNvbQ%3D%3D.893f2e4d4735c46bdafefb6fef1c628b.1700371184093.1700371184093.1700374661834.4%22%7D; _abck=1C9A26953F790F27F09DD7571F15FFB8~0~YAAQtkbNFxan1sqLAQAAe9HN7wpnhi37Qc2ZbUshD9gZEfyLUD07JvokHf1OO4MW4e4JcP6EUhGNrEM3jGR8C1xF6sofTF2WXvtAneH30ObVJgeTh+b77sQNCle70ndwsFK87rCes2HYl3FBgkYHPyp8B2hF2IXfTy02T8HwHPG4ZYFTbDMJod4+FXgylkuf2bcYDTCyZzD+LU25/0AcF3Z/k44Y0urDtK6bhFyC91nmhoqMY0T+vCDm2rp9ECQXqkpLy/LXXE7lFT1JD0oc/yBrwL9lo4KQDo1tn0BLBsNQnvXM30LgXOn6zmRDAfBRxJmcc7T4D+88h8blzO6tp4erluLV8kvG3Q8s9DD/MN4LAsu5fRx3lQ/k49tyGKX5swxuu28HL5c38eEfnaqc0BqFUGaTzao6cGE4~-1~-1~-1; bm_sz=363B2098180265E2C614DE7C6279985F~YAAQtkbNFxen1sqLAQAAe9HN7xXWm6qpw4BcZjO8IQb0pIs8SWYqqMmgjCvIu/MPT28SLlBHTV42OoD60G2RBnAt+eaHz0h60+F3ro8CpURuRM1sTkYp3w+N5I2hX0h6stJwMrcHA7QKgCCNFO8UcGn9E2Kd6eTmMsHyTkrmb+qu8F9Joju088nEGxomp4gybzTMhPnxLczWb2d5Zyn0mmqecbSV/WIm9h/cfPYPSBAn7F534p0EuF5g8+QfbtGoRk7aJeMcg7j/dRdgVAjgl5tHyX97qhf5hjZzolG1hab8M5st3rY=~4340023~3359795")
	})
	return c
}
